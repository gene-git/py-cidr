py_cidr.cidr_map
================

.. py:module:: py_cidr.cidr_map

.. autoapi-nested-parse::

   Map cidr/ips to a (str) value.
   Requires CidrCache

   Keep separate caches for ipv4 and ipv6
   cidr matches cache.cidr cidr when cidr is subnet of cache.cidr.

   Requires CidrCache for the actual cache management





Module Contents
---------------

.. py:class:: CidrMap(cache_dir: str | None = None)

   Class provides map(cidr) -> some value.

    - ipv4 and ipv6 are cached separately
    - built on CidrCache and Cidr classes

   Args:
       cache_dir (str):
       Optional directory to save cache file

   todo: generalize value to be any object not just string


   .. py:method:: add_cidr(cidr: str, result: str, priv_cache: NetCache | None = None)

      Add cidr to cache.

      Args:
          cidr (str):
          Add this cidr string and its associated result value to the map.

          result (str):
          The result value to be associated with this cidr.
          i.e. map(cidr) = result

          priv_data (private):

          If using multiple processes/threads then provide this object
          where changes are kept instead of in the instance cache.
          This way the same instance (and its cache) can be used
          across multiple processes/threads.

          Use CidrMap.create_private_cache() to create private_data




   .. py:method:: create_private_cache() -> NetCache
      :staticmethod:


      Create and Return private cache object to use with add_cidr().

      This cache has no cache_dir set - memory only.
      Required if one CidrMap instance is used in multiple processes/threads
      Give each process/thread a private data cache and they can be merged
      into the CidrMap instance after they have all completed.

      Returns:
          (private):
          private_cache_data object.



   .. py:method:: items(v6: bool = False) -> Iterator[tuple[str, Any]]

      Iterator that returns oen element at a time of the map.
      Args:
          v6 (bool):
              Default is false, and the elements are from IPv4 map
              If True, then elements are taken from the IPv6 map.
      Returns:
          tuple[cidr: str, value: str]:
              The (cidr, value) for each map element



   .. py:method:: lookup(cidr: str) -> Any | None

      Check if cidr is in map.

      Args:
          cidr (str):
          Cidr value to lookup.

      Returns:
          Any | None:
          Result = map(cidr) if found else None.



   .. py:method:: lookup_both(cidr: str) -> tuple[str, Any | None]

      Check if cidr is in map. Similar to lookup()
      but returns the cidr_found in the map as well
      as it's value

      Args:
          cidr (str):
          Cidr value to lookup.

      Returns:
          tuple[cidr_found: str, value: Any | None]
          cidr_found is the "prefix"
          If in map, then cidr_found <= cidr
          and the value is that associated with cidr_found
          If not in map, then ['', None] is returned



   .. py:method:: merge(priv_cache: NetCache | None)

      Merge private cache into our internal cache.

      Args:
          priv_data (_PrivCache):
          The "private data" to add (cidr, result) to the map, then
          this merges content of priv_data into the current data.
          priv_data must be created by CidrMap.create_private_cache()



   .. py:method:: print()

      Print the cache data.



   .. py:method:: save_cache()

      Write cache to files



.. py:class:: NetCache(cache_dir: str)

   holds both ipv4 and ipv6 cache 


   .. py:method:: get(ipt: str)

      Returns the cache for ipv4 or ipv6

      Args:
          ipt (str):
          One of 'ipv4' or 'ipv6'
      Returns:
          Cache for the requested network type



   .. py:method:: get_cache(iptype: str) -> py_cidr._cidr_cache.CidrCache

      Extract the cache for the provided iptype

      Args:
          ipt (str):
          One of 'ipv4' or 'ipv6'

      Returns:
          CidrCache:
          Cache for "iptype"



   .. py:method:: set(ipt: str, cache: py_cidr._cidr_cache.CidrCache)

      Assigns the cache for ipv4 or ipv6

      Args:
          ipt (str):
          One of 'ipv4' or 'ipv6'
      Returns:
          Cache for the requested network type



